<html>
<head>
<title>Line</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<script type="application/javascript" src="js/jquery-1.6.2.min.js"></script>

<script type="application/javascript" src="interpreter/lexer.js"></script>
<script type="application/javascript" src="interpreter/listparser.js"></script>
<script type="application/javascript" src="interpreter/parser.js"></script>
<script type="application/javascript" src="interpreter/langlib.js"></script>
<script type="application/javascript" src="interpreter/eval.js"></script>
<script type="application/javascript" src="interpreter/util.js"></script>

<script type="text/javascript" src="js/bonobonovector.js"></script>
<script type="text/javascript" src="js/motion.js"></script>

<script type="text/javascript">
	var g_interp = new Interp();
	var g_state;
	register_funcs(g_interp, motion);

	var global = this;
	var funcs = {
		'alert': alert,
		'prompt': function(msg) {
			return prompt(msg);
		},
		'setv': function(name, value) {
			var code = name + ' = ' + JSON.stringify(value) + ';';
			eval(code);
		}
	};
	register_funcs(g_interp, funcs);

	g_interp.global_env['wait_for_button'] = native_func(function(interp, args, state) {
		g_state = state;
	});
	g_interp.global_env['test'] = g_interp.eval(parse('(lambda () (alert "test"))'))

</script>

</head>
<body>
	<div id="Canvas Ex" style="float: left">
		<canvas id="screen" width="600" height="800">
		</canvas>
	</div>
	<div id="sound" >
		<audio id = "vocal" controls autoplay style="display: none;" name="media" src="http://sapzil.sigkill.kr/tts/tts_synth_api.php?w=tts&lang=ko&text=보노"></audio>

		<audio id = "sweat" controls autoplay style="display: none;" name="media" src="data/sweat.mp3"></audio>

	</div>
	<div id="content">
		<script type="text/javascript">
			init_data();
			
			face_shake_speed = 0;
			face_shake_A = 15;
			body_shake_speed = 0;
			body_shake_A = 15;
			body_arm_speed = 0.5;
			body_arm_A = 30;
			
			face_sweat_len = 3;
			
			face_eye_state = 1;
			
			face_red = 0;
			
			face_mouse_speed = 0;
			
			body_walk_dir = 2;
			
			setInterval(draw_front,time_interval);
			
		</script>
	</div>
	<textarea id="code" style="float:right; width: 40em; height: 50em;"></textarea>
	<textarea id="logbono" style="float:bottom; height: 40em;"></textarea>
	<input type="button" value="보기" id="btn" />
	<input type="button" id="faster" value="빠르게" />
	<input type="button" id="slower" value="느리게" />

	<script type="text/javascript">
		function run() {
			var inp = $('#code').val();
			var t = parse(inp);
			var res = g_interp.eval(t);
			//alert('eval finished: ' + res);
		}
		function logmsg(msg) {
			$('#logbono').val($('#logbono').val() + msg + '\n');
		}
		g_interp.global_env['logmsg'] = native_func(function(interp, args) {
			logmsg(args[0]);
		});


		$('#btn').click(run);
		$('#code').keypress(function(e) {
			if (e.which == 13) {
				run();
			}
		});

		$('#faster').click(function() {
			g_state.do_return('fast');
		});
		$('#slower').click(function() {
			g_state.do_return('slow');
		});

	</script>

</body>
</html>
